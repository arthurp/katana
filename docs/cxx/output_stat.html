<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Katana: Output Statistics of Galois Programs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Katana
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('output_stat.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Output Statistics of Galois Programs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#basic_stat">Basic Statistics</a></li>
<li class="level1"><a href="#advanced_stat">Advanced Control of Output Statistics</a></li>
<li class="level1"><a href="#self_stat">Self-defined Statistics</a></li>
<li class="level1"><a href="#stat_timer">Timing Serial Code Region</a></li>
</ul>
</div>
<div class="textblock"><p>For performance analysis, programmers instrument pieces of codes to collect program statistics.</p>
<p>Galois relieves developers from this burden by providing (1) built-in and customizable instrumentation, and (2) friendly output of statistics.</p>
<h1><a class="anchor" id="basic_stat"></a>
Basic Statistics</h1>
<p>Parallel loop iterators in Galois provide built-in instrumentation. Upon termination, Galois apps will output statistics in csv format, similar to the following:</p>
<p>STAT_TYPE, REGION, CATEGORY, TOTAL_TYPE, TOTAL<br  />
 STAT, for_each_1, Iterations, TSUM, 9028387<br  />
 STAT, for_each_1, Time, TMAX, 1663<br  />
 STAT, for_each_1, Commits, TSUM, 9000000<br  />
 STAT, for_each_1, Pushes, TSUM, 0<br  />
 STAT, for_each_1, Conflicts, TSUM, 28387<br  />
</p>
<p>The first row is the header of the csv output. REGION tells you which parallel loop the statistics are related. For example, "for_each_1" corresponds to the parallel loop which has an option of <a class="el" href="structkatana_1_1loopname.html">katana::loopname</a>("for_each_1").</p>
<p>CATEGORY specifies what are being reported for the parallel region. For <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81" title="Galois unordered set iterator.">katana::for_each</a> loops, the following five statistics are reported: </p><ol>
<li>
Iterations: the number of iterations executed </li>
<li>
Time: the runtime, in milliseconds </li>
<li>
Commits: the number of iterations committed </li>
<li>
Pushes: the number of iterations generated </li>
<li>
Conflicts: the number of iterations aborted due to conflicts </li>
</ol>
<p>For <a class="el" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff" title="Standard do-all loop.">katana::do_all</a> loops, only time and iterations are reported, since there are no conflicts and pushes in <a class="el" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff" title="Standard do-all loop.">katana::do_all</a> loops.</p>
<p>TOTAL_TYPE tells you how the statistics are derived. TSUM means that the value is the sum of all iterations' contributions; TMAX means it is the maximum among all threads for this statistic. Apart from TMAX and TSUM, Galois offers the following derivation of statistics: </p><ul>
<li>
TMIN: the value is the minimum among all threads for this statistic. </li>
<li>
TAVG: the value is the average of all contributions from all iterations to this statistic. </li>
<li>
SINGLE: a single value is returned for this statistic. This is usually used for user-defined statistics. See <a class="el" href="output_stat.html#self_stat">Self-defined Statistics</a> for examples. </li>
<li>
ThreadValues: contribution of each thread to this statistic. See <a class="el" href="output_stat.html#advanced_stat">Advanced Control of Output Statistics</a> for examples. </li>
</ul>
<p>For lonestar apps, pass -statFile path_to_csv_file as part of the command-line arguments to redirect the output of statistics of the program to file path_to_csv_file.</p>
<h1><a class="anchor" id="advanced_stat"></a>
Advanced Control of Output Statistics</h1>
<p>Users can choose the amount of output statistics reported in the following ways. </p><ol>
<li>
Turn off reporting statistics for a parallel loop by <ul>
<li>
Not passing a <a class="el" href="structkatana_1_1loopname.html">katana::loopname</a> option to the <a class="el" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff" title="Standard do-all loop.">katana::do_all</a> or <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81" title="Galois unordered set iterator.">katana::for_each</a> call; or </li>
<li>
<p class="startli">Passing <a class="el" href="structkatana_1_1no__stats.html">katana::no_stats</a> as an option to the <a class="el" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff" title="Standard do-all loop.">katana::do_all</a> or <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81" title="Galois unordered set iterator.">katana::for_each</a> call if the loopname is required, as shown in the following code snippet.</p>
<div class="fragment"><div class="line">  <a class="code" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a>(</div>
<div class="line">      <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(graph),</div>
<div class="line">      [&amp;](uint32_t i) {</div>
<div class="line">        <a class="code" href="pagerank-impl_8h.html#a9344aa3a47119b804c05a372d6095fb3">PRTy</a> rank = graph.GetData&lt;<a class="code" href="structkatana_1_1PODProperty.html">NodeValue</a>&gt;(i);</div>
<div class="line"> </div>
<div class="line">        max_rank.update(rank);</div>
<div class="line">        min_rank.update(rank);</div>
<div class="line">        distance_sum += rank;</div>
<div class="line">      },</div>
<div class="line">      <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;Sanity check&quot;</span>), <a class="code" href="structkatana_1_1no__stats.html">katana::no_stats</a>());</div>
<div class="ttc" id="anamespacekatana_html_a664a7f49a65e22807577f6cc809a7827"><div class="ttname"><a href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a></div><div class="ttdeci">auto iterate(T &amp;container)</div><div class="ttdoc">Iterate returns a specialized range object for various container-like objects:</div><div class="ttdef"><b>Definition:</b> Range.h:296</div></div>
<div class="ttc" id="anamespacekatana_html_ab9ea3b9de54b0c2f223eb585f4aefaff"><div class="ttname"><a href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a></div><div class="ttdeci">void do_all(const Range &amp;range, FunctionTy &amp;&amp;fn, Args &amp;&amp;... args)</div><div class="ttdoc">Standard do-all loop.</div><div class="ttdef"><b>Definition:</b> Loops.h:69</div></div>
<div class="ttc" id="apagerank-impl_8h_html_a9344aa3a47119b804c05a372d6095fb3"><div class="ttname"><a href="pagerank-impl_8h.html#a9344aa3a47119b804c05a372d6095fb3">PRTy</a></div><div class="ttdeci">float PRTy</div><div class="ttdef"><b>Definition:</b> pagerank-impl.h:33</div></div>
<div class="ttc" id="astructkatana_1_1PODProperty_html"><div class="ttname"><a href="structkatana_1_1PODProperty.html">katana::PODProperty</a></div><div class="ttdef"><b>Definition:</b> Properties.h:360</div></div>
<div class="ttc" id="astructkatana_1_1loopname_html"><div class="ttname"><a href="structkatana_1_1loopname.html">katana::loopname</a></div><div class="ttdef"><b>Definition:</b> Traits.h:211</div></div>
<div class="ttc" id="astructkatana_1_1no__stats_html"><div class="ttname"><a href="structkatana_1_1no__stats.html">katana::no_stats</a></div><div class="ttdef"><b>Definition:</b> Traits.h:262</div></div>
</div><!-- fragment --> </li>
</ul>
</li>
<li>
Report more statistics for a parallel loop by passing <a class="el" href="structkatana_1_1more__stats.html">katana::more_stats</a> as an option to the <a class="el" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff" title="Standard do-all loop.">katana::do_all</a> or <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81" title="Galois unordered set iterator.">katana::for_each</a> call. </li>
<li>
<p class="startli">Report per-thread contribution by setting the environmental variable "PRINT_PER_THREAD_STATS" before executing a Galois app. Below is an example execution asking for per-thread stats:</p>
<p class="interli">$&gt; PRINT_PER_THREAD_STATS=1 ./sssp input_graph -t 8</p>
<p class="interli">And below is the output with per-thread stats.</p>
<p class="interli">STAT_TYPE, REGION, CATEGORY, TOTAL_TYPE, TOTAL<br  />
 STAT, PageAlloc, MeminfoPre, TSUM, 21<br  />
 STAT, PageAlloc, MeminfoPre, ThreadValues, 7; 2; 2; 2; 2; 2; 2; 2<br  />
 STAT, PageAlloc, MeminfoPost, TSUM, 43<br  />
 STAT, PageAlloc, MeminfoPost, ThreadValues, 8; 5; 5; 5; 5; 5; 5; 5<br  />
 STAT, SSSP, Iterations, TSUM, 482052<br  />
 STAT, SSSP, Iterations, ThreadValues, 80602; 71506; 87690; 58227; 53784; 77878; 27112; 25253<br  />
 STAT, SSSP, Commits, TSUM, 482052<br  />
 STAT, SSSP, Commits, ThreadValues, 80602; 71506; 87690; 58227; 53784; 77878; 27112; 25253<br  />
 STAT, SSSP, Pushes, TSUM, 482051<br  />
 STAT, SSSP, Pushes, ThreadValues, 81305; 71954; 87562; 57907; 54168; 77942; 26152; 25061<br  />
 STAT, SSSP, Conflicts, TSUM, 0<br  />
 STAT, SSSP, Conflicts, ThreadValues, 0; 0; 0; 0; 0; 0; 0; 0<br  />
 STAT, SSSP, Time, TMAX, 19<br  />
 STAT, SSSP, Time, ThreadValues 19<br  />
 STAT, (NULL), Time, TMAX, 19<br  />
 STAT, (NULL), Time, ThreadValues, 19<br  />
 ...</p>
<p class="interli">Note the lines with TOTAL_TYPE of "ThreadValues" report sequences of statistics for threads 0 to 7 in this example. Per-thread values are reported only for stats aggregated by TSUM operation.</p>
<p class="endli"></p>
</li>
</ol>
<h1><a class="anchor" id="self_stat"></a>
Self-defined Statistics</h1>
<p>Monitor algorithm-specific statistics with the following steps. </p><ol>
<li>
Identify the aggregation of the desired statistics as reduction operations, e.g. sum, min, max, etc. </li>
<li>
Declare the reducible objects for the statistics before the parallel loop of interest. See <a class="el" href="reduction.html">Reduction Operations</a> for reducible objects available in Galois. </li>
<li>
Collect per-thread contribution for the statistics in the parallel loop of interest. </li>
<li>
Reduce and report the statistics after the parallel loop of interest. </li>
</ol>
<p>Let us use single-source shortest path (SSSP) problem to illustrate the use of self-defined statistics. In SSSP, "bad works" mean the number of iterations in which the node distance is lowered more than once. Since the amount of bad works is the sum of the bad works encountered by each thread, bad works should be collected and reduced using sum operation, which calls for a <a class="el" href="classkatana_1_1GAccumulator.html" title="Accumulator for T where accumulation is plus.">katana::GAccumulator</a>. We declare the collector before the parallel loop for SSSP as the following:</p>
<div class="fragment"><div class="line">    <a class="code" href="classkatana_1_1GAccumulator.html">katana::GAccumulator&lt;size_t&gt;</a> BadWork;</div>
<div class="ttc" id="aclasskatana_1_1GAccumulator_html"><div class="ttname"><a href="classkatana_1_1GAccumulator.html">katana::GAccumulator&lt; size_t &gt;</a></div></div>
</div><!-- fragment --><p> Then in the operator for the parallel loop for SSSP, collect per-thread contribution of bad works as the following:</p>
<div class="fragment"><div class="line">                <span class="keywordflow">if</span> (old_dist != kDistanceInfinity) {</div>
<div class="line">                  BadWork += 1;</div>
<div class="line">                }</div>
</div><!-- fragment --><p> Finally, after the parallel loop for SSSP is done, report the number of bad works as the following:</p>
<div class="fragment"><div class="line">      <a class="code" href="namespacekatana.html#a84fe29fa198c3f4ea0183dc47bd4dab2">katana::ReportStatSingle</a>(<span class="stringliteral">&quot;SSSP&quot;</span>, <span class="stringliteral">&quot;BadWork&quot;</span>, BadWork.<a class="code" href="classkatana_1_1Reducible.html#aa3553aa133d0ef88c5c19cabe7e33e1f">reduce</a>());</div>
<div class="ttc" id="aclasskatana_1_1Reducible_html_aa3553aa133d0ef88c5c19cabe7e33e1f"><div class="ttname"><a href="classkatana_1_1Reducible.html#aa3553aa133d0ef88c5c19cabe7e33e1f">katana::Reducible::reduce</a></div><div class="ttdeci">T &amp; reduce()</div><div class="ttdoc">Returns the final reduction value.</div><div class="ttdef"><b>Definition:</b> Reduction.h:101</div></div>
<div class="ttc" id="anamespacekatana_html_a84fe29fa198c3f4ea0183dc47bd4dab2"><div class="ttname"><a href="namespacekatana.html#a84fe29fa198c3f4ea0183dc47bd4dab2">katana::ReportStatSingle</a></div><div class="ttdeci">void ReportStatSingle(const std::string &amp;region, const std::string &amp;category, const T &amp;value)</div><div class="ttdef"><b>Definition:</b> Statistics.h:399</div></div>
</div><!-- fragment --><p> In the above example, the TOTAL_TYPE for BadWork is SINGLE.</p>
<p><a class="el" href="namespacekatana.html#a84fe29fa198c3f4ea0183dc47bd4dab2">katana::ReportStatSingle</a> can be used if the statistic is reduced to a single value before being reported. Other stat reporting functions are <a class="el" href="namespacekatana.html#aadba2f74a01e10f763b69d35a82f6e32">katana::ReportStatMax</a>, <a class="el" href="namespacekatana.html#aac002eeebe4f90a37639b20f87128949">katana::ReportStatMin</a>, <a class="el" href="namespacekatana.html#af26b2591ad27d49579dea66ae5983422">katana::ReportStatSum</a>, and <a class="el" href="namespacekatana.html#a7ee12a7e5a9f79720a3149e1da78a009">katana::ReportStatAvg</a>, but they are rarely used in user code. The suffix of a stat reporting function indicates the TOTAL_TYPE for the statistic being reported. All the stat reporting functions take three parameters: name for the region, name for the statistic, and the value to be aggregated/reported.</p>
<h1><a class="anchor" id="stat_timer"></a>
Timing Serial Code Region</h1>
<p>The runtime of a serial code region, in milliseconds, can be measured by enclosing the code region in between calls to <a class="el" href="classkatana_1_1StatTimer.html#abf7b1d592158dee50482feabe4ee5daf">katana::StatTimer::start</a> and <a class="el" href="classkatana_1_1StatTimer.html#ad200173bde20a290c303d59ba6095daf">katana::StatTimer::stop</a>. The following code snippet shows an example from <a class="el" href="lonestar_2tutorial_examples_2GraphTraversalSerial_8cpp-example.html">lonestar/tutorial_examples/GraphTraversalSerial.cpp</a>:</p>
<div class="fragment"><div class="line">  <span class="comment">//******************************************************</span></div>
<div class="line">  <span class="comment">// serial traversal over a graph</span></div>
<div class="line">  <span class="comment">// sum over nodes and edges in C++11 syntax</span></div>
<div class="line">  <a class="code" href="classkatana_1_1StatTimer.html">katana::StatTimer</a> T(<span class="stringliteral">&quot;sum_serial&quot;</span>);</div>
<div class="line">  T.start();</div>
<div class="line">  <span class="comment">// iterate over nodes</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> n : g) {</div>
<div class="line">    <span class="keyword">auto</span>&amp; sum = g.getData(n);  <span class="comment">// get node data of n</span></div>
<div class="line">    sum = 0;</div>
<div class="line">    <span class="comment">// iterate over edges from node n</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> e : g.edges(n)) {</div>
<div class="line">      sum += g.getEdgeData(e);  <span class="comment">// get edge data of e</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  T.stop();</div>
<div class="ttc" id="aclasskatana_1_1StatTimer_html"><div class="ttname"><a href="classkatana_1_1StatTimer.html">katana::StatTimer</a></div><div class="ttdoc">Galois Timer that automatically reports stats upon destruction Provides statistic interface around ti...</div><div class="ttdef"><b>Definition:</b> Timer.h:63</div></div>
</div><!-- fragment --><p> After program termination, the timer will output statistics like the following:</p>
<p>STAT_TYPE, REGION, CATEGORY, TOTAL_TYPE, TOTAL<br  />
 STAT, (NULL), sum_serial, TMAX, 15<br  />
</p>
<p>Note that the name fed to the timer is printed as a category under the region "(NULL)". </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Manual.html">Manual</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
