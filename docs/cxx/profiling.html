<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Katana: Profiling Galois Code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Katana
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('profiling.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Profiling Galois Code </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#profile_w_vtune">Profiling with Intel VTune</a></li>
<li class="level1"><a href="#profile_w_papi">Profiling with PAPI</a></li>
</ul>
</div>
<div class="textblock"><p>When optimizing Galois apps, you may need to work with an external profiling infrastructure to have an idea about the performance in micro-architectural level.</p>
<p>Currently Galois supports profiling with Intel VTune and PAPI. For this to work, you need to include the header <a class="el" href="Profile_8h.html">katana/Profile.h</a>, and instrument your code as the following sections suggest.</p>
<h1><a class="anchor" id="profile_w_vtune"></a>
Profiling with Intel VTune</h1>
<p><a href="https://software.intel.com/en-us/intel-vtune-amplifier-xe">Intel VTune</a> is a profiling tool offered by Intel in Intel Parallel Studio.</p>
<p>Turn on the use of Intel VTune by running cmake with -DKATANA_ENABLE_VTUNE=1 option. Instrument the code region of interest with <a class="el" href="namespacekatana.html#a1acae7c4c5982885cb541db7faa5f22f">katana::profileVtune</a>, which expects two arguments: (1) the code region to be profiled as a lambda expression, functor, etc., and (2) the name for the code region. Below is an example of profiling the node-iterator algorithm for triangle counting with Intel VTune:</p>
<div class="fragment"><div class="line">  <a class="code" href="namespacekatana.html#a1acae7c4c5982885cb541db7faa5f22f">katana::profileVtune</a>(</div>
<div class="line">      [&amp;]() {</div>
<div class="line">        <a class="code" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a>(</div>
<div class="line">            <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(graph),</div>
<div class="line">            [&amp;](<span class="keyword">const</span> <a class="code" href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a>&amp; n) {</div>
<div class="line">              <span class="comment">// Partition neighbors</span></div>
<div class="line">              <span class="comment">// [first, ea) [n] [bb, last)</span></div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> first = graph.edge_begin(n);</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> last = graph.edge_end(n);</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> ea =</div>
<div class="line">                  <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(first, last, <a class="code" href="structLessThan.html">LessThan&lt;Graph&gt;</a>(graph, n));</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> bb =</div>
<div class="line">                  <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(first, last, <a class="code" href="structGreaterThanOrEqual.html">GreaterThanOrEqual&lt;Graph&gt;</a>(graph, n));</div>
<div class="line"> </div>
<div class="line">              <span class="keywordflow">for</span> (; bb != last; ++bb) {</div>
<div class="line">                <a class="code" href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a> B = *graph.GetEdgeDest(bb);</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keyword">auto</span> aa = first; aa != ea; ++aa) {</div>
<div class="line">                  <a class="code" href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a> A = *graph.GetEdgeDest(aa);</div>
<div class="line">                  <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> vv = graph.edge_begin(A);</div>
<div class="line">                  <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> ev = graph.edge_end(A);</div>
<div class="line">                  <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> it =</div>
<div class="line">                      <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(vv, ev, <a class="code" href="structLessThan.html">LessThan&lt;Graph&gt;</a>(graph, B));</div>
<div class="line">                  <span class="keywordflow">if</span> (it != ev &amp;&amp; *graph.GetEdgeDest(it) == B) {</div>
<div class="line">                    numTriangles += 1;</div>
<div class="line">                  }</div>
<div class="line">                }</div>
<div class="line">              }</div>
<div class="line">            },</div>
<div class="line">            <a class="code" href="structkatana_1_1chunk__size.html">katana::chunk_size&lt;CHUNK_SIZE&gt;</a>(), <a class="code" href="structkatana_1_1steal.html">katana::steal</a>(),</div>
<div class="line">            <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;NodeIteratingAlgo&quot;</span>));</div>
<div class="line">      },</div>
<div class="line">      <span class="stringliteral">&quot;nodeIteratorAlgo&quot;</span>);</div>
<div class="ttc" id="aclasskatana_1_1TypedPropertyGraph_html_ac13a5221469c028a290f05a84738a6ec"><div class="ttname"><a href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">katana::TypedPropertyGraph::edge_iterator</a></div><div class="ttdeci">GraphTopology::edge_iterator edge_iterator</div><div class="ttdef"><b>Definition:</b> TypedPropertyGraph.h:51</div></div>
<div class="ttc" id="ajaccard_8cpp_html_ac56cf62167e787bf1a4ff1e5b529e0b0"><div class="ttname"><a href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a></div><div class="ttdeci">Graph::Node GNode</div><div class="ttdef"><b>Definition:</b> jaccard.cpp:31</div></div>
<div class="ttc" id="anamespacekatana_html_a1acae7c4c5982885cb541db7faa5f22f"><div class="ttname"><a href="namespacekatana.html#a1acae7c4c5982885cb541db7faa5f22f">katana::profileVtune</a></div><div class="ttdeci">void profileVtune(const F &amp;func, const char *region)</div><div class="ttdef"><b>Definition:</b> Profile.h:69</div></div>
<div class="ttc" id="anamespacekatana_html_a664a7f49a65e22807577f6cc809a7827"><div class="ttname"><a href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a></div><div class="ttdeci">auto iterate(T &amp;container)</div><div class="ttdoc">Iterate returns a specialized range object for various container-like objects:</div><div class="ttdef"><b>Definition:</b> Range.h:296</div></div>
<div class="ttc" id="anamespacekatana_html_ab9ea3b9de54b0c2f223eb585f4aefaff"><div class="ttname"><a href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a></div><div class="ttdeci">void do_all(const Range &amp;range, FunctionTy &amp;&amp;fn, Args &amp;&amp;... args)</div><div class="ttdoc">Standard do-all loop.</div><div class="ttdef"><b>Definition:</b> Loops.h:69</div></div>
<div class="ttc" id="astructGreaterThanOrEqual_html"><div class="ttname"><a href="structGreaterThanOrEqual.html">GreaterThanOrEqual</a></div><div class="ttdef"><b>Definition:</b> triangle_count.cpp:96</div></div>
<div class="ttc" id="astructLessThan_html"><div class="ttname"><a href="structLessThan.html">LessThan</a></div><div class="ttdef"><b>Definition:</b> triangle_count.cpp:86</div></div>
<div class="ttc" id="astructkatana_1_1chunk__size_html"><div class="ttname"><a href="structkatana_1_1chunk__size.html">katana::chunk_size</a></div><div class="ttdoc">Specify chunk size for do_all_coupled &amp; do_all_choice at compile time or at runtime.</div><div class="ttdef"><b>Definition:</b> Traits.h:372</div></div>
<div class="ttc" id="astructkatana_1_1loopname_html"><div class="ttname"><a href="structkatana_1_1loopname.html">katana::loopname</a></div><div class="ttdef"><b>Definition:</b> Traits.h:211</div></div>
<div class="ttc" id="astructkatana_1_1steal_html"><div class="ttname"><a href="structkatana_1_1steal.html">katana::steal</a></div><div class="ttdef"><b>Definition:</b> Traits.h:220</div></div>
<div class="ttc" id="atriangle__count_8cpp_html_a58a3d002f0fc9307ac05b87db1bcdc80"><div class="ttname"><a href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a></div><div class="ttdeci">Iterator LowerBound(Iterator first, Iterator last, Compare comp)</div><div class="ttdoc">Like std::lower_bound but doesn't dereference iterators.</div><div class="ttdef"><b>Definition:</b> triangle_count.cpp:37</div></div>
</div><!-- fragment --><p> Compile your code and run with Intel VTune to collect statistics.</p>
<h1><a class="anchor" id="profile_w_papi"></a>
Profiling with PAPI</h1>
<p><a href="http://icl.cs.utk.edt/papi/">PAPI</a> stands for "Performance Application Programming Interface".</p>
<p>Turn on the use of PAPI by running cmake with -DKATANA_ENABLE_PAPI=1 option. Instrument the code region of interest with <a class="el" href="namespacekatana.html#abd798540cfe7c5d97e689d9502c1c639">katana::profilePapi</a>, which expects two arguments: (1) the code region to be profiled as a lambda expression, functor, etc., and (2) the name for the code region. Below is an example of profiling the edge-iterator algorithm for triangle counting with PAPI:</p>
<div class="fragment"><div class="line">  <a class="code" href="namespacekatana.html#abd798540cfe7c5d97e689d9502c1c639">katana::profilePapi</a>(</div>
<div class="line">      [&amp;]() {</div>
<div class="line">        <a class="code" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a>(</div>
<div class="line">            <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(items),</div>
<div class="line">            [&amp;](<span class="keyword">const</span> WorkItem&amp; w) {</div>
<div class="line">              <span class="comment">// Compute intersection of range (w.src, w.dst) in neighbors of</span></div>
<div class="line">              <span class="comment">// w.src and w.dst</span></div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> abegin = graph.edge_begin(w.src);</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> aend = graph.edge_end(w.src);</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> bbegin = graph.edge_begin(w.dst);</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> bend = graph.edge_end(w.dst);</div>
<div class="line"> </div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> aa = <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(</div>
<div class="line">                  abegin, aend, <a class="code" href="structGreaterThanOrEqual.html">GreaterThanOrEqual&lt;Graph&gt;</a>(graph, w.src));</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> ea =</div>
<div class="line">                  <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(abegin, aend, <a class="code" href="structLessThan.html">LessThan&lt;Graph&gt;</a>(graph, w.dst));</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> bb = <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(</div>
<div class="line">                  bbegin, bend, <a class="code" href="structGreaterThanOrEqual.html">GreaterThanOrEqual&lt;Graph&gt;</a>(graph, w.src));</div>
<div class="line">              <a class="code" href="classkatana_1_1TypedPropertyGraph.html#ac13a5221469c028a290f05a84738a6ec">Graph::edge_iterator</a> eb =</div>
<div class="line">                  <a class="code" href="triangle__count_8cpp.html#a58a3d002f0fc9307ac05b87db1bcdc80">LowerBound</a>(bbegin, bend, <a class="code" href="structLessThan.html">LessThan&lt;Graph&gt;</a>(graph, w.dst));</div>
<div class="line"> </div>
<div class="line">              numTriangles += <a class="code" href="triangle__count_8cpp.html#a2bd4f0189e1bc9d06cd1cbe941cb183d">CountEqual</a>(graph, aa, ea, bb, eb);</div>
<div class="line">            },</div>
<div class="line">            <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;EdgeIteratingAlgo&quot;</span>),</div>
<div class="line">            <a class="code" href="structkatana_1_1chunk__size.html">katana::chunk_size&lt;CHUNK_SIZE&gt;</a>(), <a class="code" href="structkatana_1_1steal.html">katana::steal</a>());</div>
<div class="line">      },</div>
<div class="line">      <span class="stringliteral">&quot;edgeIteratorAlgo&quot;</span>);</div>
<div class="ttc" id="anamespacekatana_html_abd798540cfe7c5d97e689d9502c1c639"><div class="ttname"><a href="namespacekatana.html#abd798540cfe7c5d97e689d9502c1c639">katana::profilePapi</a></div><div class="ttdeci">void profilePapi(const F &amp;func, const char *region)</div><div class="ttdef"><b>Definition:</b> Profile.h:236</div></div>
<div class="ttc" id="atriangle__count_8cpp_html_a2bd4f0189e1bc9d06cd1cbe941cb183d"><div class="ttname"><a href="triangle__count_8cpp.html#a2bd4f0189e1bc9d06cd1cbe941cb183d">CountEqual</a></div><div class="ttdeci">size_t CountEqual(const G &amp;g, typename G::edge_iterator aa, typename G::edge_iterator ea, typename G::edge_iterator bb, typename G::edge_iterator eb)</div><div class="ttdoc">std::set_intersection over edge_iterators.</div><div class="ttdef"><b>Definition:</b> triangle_count.cpp:65</div></div>
</div><!-- fragment --><p> Compile your code and run with a sequence of PAPI counters you want to collect. Below is an example command-line:</p>
<p>$&gt; KATANA_PAPI_EVENTS="PAPI_L1_DCM,PAPI_L2_DCM,PAPI_BR_MSP,PAPI_TOT_INS,PAPI_TOT_CYC" ./triangles input_graph -algo edgeiterator -t 24</p>
<p>Upon program termination, the value of PAPI counters will be reported along with other statistics in csv output, similar to the following:</p>
<p>STAT_TYPE, REGION, CATEGORY, TOTAL_TYPE, TOTAL<br  />
 STAT, PageAlloc, MeminfoPre, TSUM, 53<br  />
 STAT, PageAlloc, MeminfoPost, TSUM, 122<br  />
 STAT, Initialize, Iterations, TSUM, 264346<br  />
 STAT, Initialize, Time, TMAX, 17<br  />
 STAT, edgeIteratingAlgo, Iterations, TSUM, 730100<br  />
 STAT, edgeIteratingAlgo, Time, TMAX, 21<br  />
 STAT, edgeIteratorAlgo, Time, TMAX, 21<br  />
 STAT, edgeIteratorAlgo, PAPI_L1_DCM, TSUM, 613659<br  />
 STAT, edgeIteratorAlgo, PAPI_L2_DCM, TSUM, 368932<br  />
 STAT, edgeIteratorAlgo, PAPI_BR_MSP, TSUM, 1901191<br  />
 STAT, edgeIteratorAlgo, PAPI_TOT_INS, TSUM, 293743102<br  />
 STAT, edgeIteratorAlgo, PAPI_TOT_CYC, TSUM, 548013881<br  />
 STAT, (NULL), Time, TMAX, 263<br  />
 STAT, (NULL), GraphReadingTime, TMAX, 26<br  />
 ...</p>
<p>Note that the PAPI counters are reported as categories for the region "edgeIteratorAlgo", the name provided to the <a class="el" href="namespacekatana.html#abd798540cfe7c5d97e689d9502c1c639">katana::profilePapi</a> call. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Manual.html">Manual</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
