<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Katana: Reduction Operations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Katana
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('reduction.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Reduction Operations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#reduction_intro">Introduction</a></li>
<li class="level1"><a href="#scalar-reduction">Scalar Reduction</a><ul><li class="level2"><a href="#scalar-define">Defining a Reducer</a></li>
<li class="level2"><a href="#scalar-reduce">Reducing Values</a></li>
<li class="level2"><a href="#scalar-example">Example</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="reduction_intro"></a>
Introduction</h1>
<p>Reduction is a fundamental operation used in different graph analytics problems such as bread-first search (BFS), connected components (CC), and PageRank (PR). As such, the Galois runtime provides support for different types of reduction operations such as addition (also known as accumulation).</p>
<p>Data structures that support reductions in Galois are conceptually divided into two classes: reduction of scalar types (e.g., ints and floats) or reduction of container types (e.g., STL vectors and maps).</p>
<h1><a class="anchor" id="scalar-reduction"></a>
Scalar Reduction</h1>
<p><a class="el" href="classkatana_1_1Reducible.html">katana::Reducible</a> is the base class to help reduce values of primitive types or types that are cheap to copy. For example, <a class="el" href="classkatana_1_1GAccumulator.html">katana::GAccumulator</a> is for accumulating values of types such as ints.</p>
<h2><a class="anchor" id="scalar-define"></a>
Defining a Reducer</h2>
<p><a class="el" href="classkatana_1_1Reducible.html">katana::Reducible</a> is used to reduce mutliple values of type <code>T</code> to a single value. It is optimized for basic types or types that have low overheads while copying. <a class="el" href="classkatana_1_1Reducible.html">katana::Reducible</a> takes the type <code>T</code> of the values to be reduced and a functor <code>MergeFunc</code> as template parameters, where the <code>MergeFunc</code> conforms to:</p>
<div class="fragment"><div class="line">T operator()(<span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b);</div>
</div><!-- fragment --><h2><a class="anchor" id="scalar-reduce"></a>
Reducing Values</h2>
<p><a class="el" href="classkatana_1_1Reducible.html">katana::Reducible</a> starts with the default value of type <code>T</code>. <a class="el" href="classkatana_1_1Reducible.html#a35a921b6cdf08ca563bd80ca8d46fac1">katana::Reducible::update()</a> updates the thread local value by applying the reduction operator to the thread local and provided value. After a parallel region, the final value can be retrieved using <a class="el" href="classkatana_1_1Reducible.html#aa3553aa133d0ef88c5c19cabe7e33e1f">katana::Reducible::reduce()</a>. Note, that <a class="el" href="classkatana_1_1Reducible.html#aa3553aa133d0ef88c5c19cabe7e33e1f">katana::Reducible::reduce()</a> can only be used outside of parallel regions (e.g., <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81">katana::for_each</a>).</p>
<p>The following figure shows the inheritance hierarachy of Galois classes that implement support for scalar reduction operations.</p>
<p> <style>div.image img[src="scalar-reductions.png"]{width:700px;}</style>  </p><div class="image">
<img src="scalar-reductions.png" alt=""/>
<div class="caption">
Scalar reducers in Galois</div></div>
<p>These specialized reducer classes implement support for different types of reduction operations by inheriting from <a class="el" href="classkatana_1_1Reducible.html">katana::Reducible</a>:</p>
<ul>
<li><a class="el" href="classkatana_1_1GAccumulator.html">katana::GAccumulator</a> is used to accumulate a set of values. It provides <a class="el" href="classkatana_1_1GAccumulator.html#a8100d2fb846c53660f96fdd4a2563e75">katana::GAccumulator::operator+=</a> and <a class="el" href="classkatana_1_1GAccumulator.html#abcf940b500f5d1073a91efed7bf1fc4c">katana::GAccumulator::operator-=</a> for adding or subtracting values.</li>
<li><a class="el" href="classkatana_1_1GReduceMax.html">katana::GReduceMax</a> is used to reduce to the maximum value. Type <code>T</code> has to meet the type requirements of <code>std::max</code>.</li>
<li><a class="el" href="classkatana_1_1GReduceMin.html">katana::GReduceMin</a> is used to reduce to the minimum value. Type <code>T</code> has to meet the type requirements of <code>std::min</code>.</li>
<li><a class="el" href="classkatana_1_1GReduceLogicalAnd.html">katana::GReduceLogicalAnd</a> is used to perform a <code>logical and</code> of the accumulated values. Type <code>T</code> has to meet the type requirements of <code>std::logical_and</code>.</li>
<li><a class="el" href="classkatana_1_1GReduceLogicalOr.html">katana::GReduceLogicalOr</a> is used to perform a <code>logical or</code> of the accumulated values. Type <code>T</code> has to meet the type requirements of <code>std::logical_or</code>.</li>
</ul>
<h2><a class="anchor" id="scalar-example"></a>
Example</h2>
<p>In the following, we show an example of using reduction operations in a common graph analytics application, PageRank. The residual pull-based algorithm for PageRank uses <a class="el" href="classkatana_1_1GAccumulator.html">katana::GAccumulator</a> to keep track of whether a node with outgoing neighbors has new PageRank contribution that needs to be propagated. The PageRank computation can terminate if the reduced value across all nodes in the graph is zero (i.e., implying no more work).</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">ComputePRResidual(</div>
<div class="line">    <a class="code" href="classkatana_1_1TypedPropertyGraph.html">Graph</a>* graph, DeltaArray&amp; delta, ResidualArray&amp; residual,</div>
<div class="line">    <a class="code" href="classkatana_1_1analytics_1_1PagerankPlan.html">katana::analytics::PagerankPlan</a> plan) {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iterations = 0;</div>
<div class="line">  <a class="code" href="classkatana_1_1GAccumulator.html">katana::GAccumulator&lt;unsigned int&gt;</a> accum;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <a class="code" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a>(</div>
<div class="line">        <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(*graph),</div>
<div class="line">        [&amp;](<span class="keyword">const</span> <a class="code" href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a>&amp; src) {</div>
<div class="line">          <span class="keyword">auto</span>&amp; sdata_value = graph-&gt;<a class="code" href="classkatana_1_1TypedPropertyGraph.html#a6f4d8f6ce5a13bbc3e08eec2a7973347">GetData</a>&lt;<a class="code" href="structkatana_1_1PODProperty.html">NodeValue</a>&gt;(src);</div>
<div class="line">          <span class="keyword">auto</span>&amp; sdata_nout = graph-&gt;<a class="code" href="classkatana_1_1TypedPropertyGraph.html#a6f4d8f6ce5a13bbc3e08eec2a7973347">GetData</a>&lt;NodeNout&gt;(src);</div>
<div class="line">          delta[src] = 0;</div>
<div class="line"> </div>
<div class="line">          <span class="keywordflow">if</span> (residual[src] &gt; plan.<a class="code" href="classkatana_1_1analytics_1_1PagerankPlan.html#aba25bc543558315ef151eb918a5dd829">tolerance</a>()) {</div>
<div class="line">            <a class="code" href="pagerank-impl_8h.html#a9344aa3a47119b804c05a372d6095fb3">PRTy</a> old_residual = residual[src];</div>
<div class="line">            residual[src] = 0.0;</div>
<div class="line">            sdata_value += old_residual;</div>
<div class="line">            <span class="keywordflow">if</span> (sdata_nout &gt; 0) {</div>
<div class="line">              delta[src] = old_residual * plan.<a class="code" href="classkatana_1_1analytics_1_1PagerankPlan.html#afd72dba73b0da8a9587a15948c5536d8">alpha</a>() / sdata_nout;</div>
<div class="line">              accum += 1;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        <a class="code" href="structkatana_1_1no__stats.html">katana::no_stats</a>(), <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;PageRank_delta&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a>(</div>
<div class="line">        <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(*graph),</div>
<div class="line">        [&amp;](<span class="keyword">const</span> <a class="code" href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a>&amp; src) {</div>
<div class="line">          <span class="keywordtype">float</span> sum = 0;</div>
<div class="line">          <span class="keywordflow">for</span> (<span class="keyword">auto</span> nbr : graph-&gt;<a class="code" href="classkatana_1_1TypedPropertyGraph.html#a5b82ab189804daaa9f5b4a27cd96307d">edges</a>(src)) {</div>
<div class="line">            auto dest = graph-&gt;GetEdgeDest(nbr);</div>
<div class="line">            if (delta[*dest] &gt; 0) {</div>
<div class="line">              sum += delta[*dest];</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">if</span> (sum &gt; 0) {</div>
<div class="line">            residual[src] = sum;</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        <a class="code" href="structkatana_1_1steal.html">katana::steal</a>(),</div>
<div class="line">        <a class="code" href="structkatana_1_1chunk__size.html">katana::chunk_size&lt;katana::analytics::PagerankPlan::kChunkSize&gt;</a>(),</div>
<div class="line">        <a class="code" href="structkatana_1_1no__stats.html">katana::no_stats</a>(), <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;PageRank&quot;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if DEBUG</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;iteration: &quot;</span> &lt;&lt; iterations &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    iterations++;</div>
<div class="line">    <span class="keywordflow">if</span> (iterations &gt;= plan.<a class="code" href="classkatana_1_1analytics_1_1PagerankPlan.html#aed8477b52f06562018a15c2b5c830234">max_iterations</a>() || !accum.<a class="code" href="classkatana_1_1Reducible.html#aa3553aa133d0ef88c5c19cabe7e33e1f">reduce</a>()) {</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    accum.<a class="code" href="classkatana_1_1Reducible.html#aeccd642d5872f6e85ab13e7d1f27f1f6">reset</a>();</div>
<div class="line">  }  </div>
<div class="ttc" id="aclasskatana_1_1GAccumulator_html"><div class="ttname"><a href="classkatana_1_1GAccumulator.html">katana::GAccumulator</a></div><div class="ttdoc">Accumulator for T where accumulation is plus.</div><div class="ttdef"><b>Definition:</b> Reduction.h:170</div></div>
<div class="ttc" id="aclasskatana_1_1Reducible_html_aa3553aa133d0ef88c5c19cabe7e33e1f"><div class="ttname"><a href="classkatana_1_1Reducible.html#aa3553aa133d0ef88c5c19cabe7e33e1f">katana::Reducible::reduce</a></div><div class="ttdeci">T &amp; reduce()</div><div class="ttdoc">Returns the final reduction value.</div><div class="ttdef"><b>Definition:</b> Reduction.h:101</div></div>
<div class="ttc" id="aclasskatana_1_1Reducible_html_aeccd642d5872f6e85ab13e7d1f27f1f6"><div class="ttname"><a href="classkatana_1_1Reducible.html#aeccd642d5872f6e85ab13e7d1f27f1f6">katana::Reducible::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> Reduction.h:112</div></div>
<div class="ttc" id="aclasskatana_1_1TypedPropertyGraph_html"><div class="ttname"><a href="classkatana_1_1TypedPropertyGraph.html">katana::TypedPropertyGraph</a></div><div class="ttdoc">A property graph is a graph that has properties associated with its nodes and edges.</div><div class="ttdef"><b>Definition:</b> TypedPropertyGraph.h:33</div></div>
<div class="ttc" id="aclasskatana_1_1TypedPropertyGraph_html_a5b82ab189804daaa9f5b4a27cd96307d"><div class="ttname"><a href="classkatana_1_1TypedPropertyGraph.html#a5b82ab189804daaa9f5b4a27cd96307d">katana::TypedPropertyGraph::edges</a></div><div class="ttdeci">edges_range edges(Node node) const</div><div class="ttdoc">Gets the edge range of some node.</div><div class="ttdef"><b>Definition:</b> TypedPropertyGraph.h:146</div></div>
<div class="ttc" id="aclasskatana_1_1TypedPropertyGraph_html_a6f4d8f6ce5a13bbc3e08eec2a7973347"><div class="ttname"><a href="classkatana_1_1TypedPropertyGraph.html#a6f4d8f6ce5a13bbc3e08eec2a7973347">katana::TypedPropertyGraph::GetData</a></div><div class="ttdeci">PropertyReferenceType&lt; NodeIndex &gt; GetData(const Node &amp;node)</div><div class="ttdoc">Gets the node data.</div><div class="ttdef"><b>Definition:</b> TypedPropertyGraph.h:76</div></div>
<div class="ttc" id="aclasskatana_1_1analytics_1_1PagerankPlan_html"><div class="ttname"><a href="classkatana_1_1analytics_1_1PagerankPlan.html">katana::analytics::PagerankPlan</a></div><div class="ttdoc">A computational plan to for Page Rank, specifying the algorithm and any parameters associated with it...</div><div class="ttdef"><b>Definition:</b> pagerank.h:14</div></div>
<div class="ttc" id="aclasskatana_1_1analytics_1_1PagerankPlan_html_aba25bc543558315ef151eb918a5dd829"><div class="ttname"><a href="classkatana_1_1analytics_1_1PagerankPlan.html#aba25bc543558315ef151eb918a5dd829">katana::analytics::PagerankPlan::tolerance</a></div><div class="ttdeci">float tolerance() const</div><div class="ttdef"><b>Definition:</b> pagerank.h:54</div></div>
<div class="ttc" id="aclasskatana_1_1analytics_1_1PagerankPlan_html_aed8477b52f06562018a15c2b5c830234"><div class="ttname"><a href="classkatana_1_1analytics_1_1PagerankPlan.html#aed8477b52f06562018a15c2b5c830234">katana::analytics::PagerankPlan::max_iterations</a></div><div class="ttdeci">unsigned int max_iterations() const</div><div class="ttdef"><b>Definition:</b> pagerank.h:55</div></div>
<div class="ttc" id="aclasskatana_1_1analytics_1_1PagerankPlan_html_afd72dba73b0da8a9587a15948c5536d8"><div class="ttname"><a href="classkatana_1_1analytics_1_1PagerankPlan.html#afd72dba73b0da8a9587a15948c5536d8">katana::analytics::PagerankPlan::alpha</a></div><div class="ttdeci">float alpha() const</div><div class="ttdef"><b>Definition:</b> pagerank.h:56</div></div>
<div class="ttc" id="ajaccard_8cpp_html_ac56cf62167e787bf1a4ff1e5b529e0b0"><div class="ttname"><a href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a></div><div class="ttdeci">Graph::Node GNode</div><div class="ttdef"><b>Definition:</b> jaccard.cpp:31</div></div>
<div class="ttc" id="anamespacekatana_html_a664a7f49a65e22807577f6cc809a7827"><div class="ttname"><a href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a></div><div class="ttdeci">auto iterate(T &amp;container)</div><div class="ttdoc">Iterate returns a specialized range object for various container-like objects:</div><div class="ttdef"><b>Definition:</b> Range.h:296</div></div>
<div class="ttc" id="anamespacekatana_html_ab9ea3b9de54b0c2f223eb585f4aefaff"><div class="ttname"><a href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff">katana::do_all</a></div><div class="ttdeci">void do_all(const Range &amp;range, FunctionTy &amp;&amp;fn, Args &amp;&amp;... args)</div><div class="ttdoc">Standard do-all loop.</div><div class="ttdef"><b>Definition:</b> Loops.h:69</div></div>
<div class="ttc" id="apagerank-impl_8h_html_a9344aa3a47119b804c05a372d6095fb3"><div class="ttname"><a href="pagerank-impl_8h.html#a9344aa3a47119b804c05a372d6095fb3">PRTy</a></div><div class="ttdeci">float PRTy</div><div class="ttdef"><b>Definition:</b> pagerank-impl.h:33</div></div>
<div class="ttc" id="astructkatana_1_1PODProperty_html"><div class="ttname"><a href="structkatana_1_1PODProperty.html">katana::PODProperty</a></div><div class="ttdef"><b>Definition:</b> Properties.h:360</div></div>
<div class="ttc" id="astructkatana_1_1chunk__size_html"><div class="ttname"><a href="structkatana_1_1chunk__size.html">katana::chunk_size</a></div><div class="ttdoc">Specify chunk size for do_all_coupled &amp; do_all_choice at compile time or at runtime.</div><div class="ttdef"><b>Definition:</b> Traits.h:372</div></div>
<div class="ttc" id="astructkatana_1_1loopname_html"><div class="ttname"><a href="structkatana_1_1loopname.html">katana::loopname</a></div><div class="ttdef"><b>Definition:</b> Traits.h:211</div></div>
<div class="ttc" id="astructkatana_1_1no__stats_html"><div class="ttname"><a href="structkatana_1_1no__stats.html">katana::no_stats</a></div><div class="ttdef"><b>Definition:</b> Traits.h:262</div></div>
<div class="ttc" id="astructkatana_1_1steal_html"><div class="ttname"><a href="structkatana_1_1steal.html">katana::steal</a></div><div class="ttdef"><b>Definition:</b> Traits.h:220</div></div>
</div><!-- fragment --><p> <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Manual.html">Manual</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
