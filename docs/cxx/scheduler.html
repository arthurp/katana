<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Katana: Scheduler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Katana
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('scheduler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Scheduler </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#wl_intro">Introduction</a></li>
<li class="level1"><a href="#chunked_wl">Chunked Worklists</a></li>
<li class="level1"><a href="#obim_wl">Ordered By Integer Metric (OBIM)</a></li>
<li class="level1"><a href="#bsp_wl">BulkSynchronous</a></li>
<li class="level1"><a href="#lq_wl">LocalQueue</a></li>
<li class="level1"><a href="#onwer_wl">OwnerComputes</a></li>
<li class="level1"><a href="#stable_iter_wl">StableIterator</a></li>
<li class="level1"><a href="#seq_wl">Sequential Worklists</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="wl_intro"></a>
Introduction</h1>
<p>Worklists are required to track work items in data-driven algorithms. A scheduling policy indicates the order by which work items are extracted from a worklist. Galois provides various scheduling policies in the namespace katana, which can be instantiated by providing one of them as the template parameter of <a class="el" href="namespacekatana.html#a0a996c85bab3fdbf1afad32e8595db32">katana::wl</a>, an optional parameter to <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81" title="Galois unordered set iterator.">katana::for_each</a>. Below we will cover Galois schedulers, starting from commonly used ones.</p>
<h1><a class="anchor" id="chunked_wl"></a>
Chunked Worklists</h1>
<p>Chunked worklists assign work items to threads one chunk at a time. Similarly, each thread accumulates new work in a chunk before putting it on the worklist. Chunking offers better scalability because threads can amortize the cost of their access to the shared worklist over the entire chunk. The user chooses the size of the chunk: A large chunk size means less contention on the shared worklist, but may lead to load-imbalance, while a small chunk size may increase the contention on the shared worklist.</p>
<p>The worklist of chunks itself can be organized in different ways, and we have observed that mapping the communication patterns of threads to the hardware-topology leads to more scalable implementations:</p>
<ul>
<li><a class="el" href="namespacekatana.html#ab7c790c9b26b98e164abc2c5e0449d45" title="Chunk FIFO.">katana::ChunkFIFO</a> (or <a class="el" href="namespacekatana.html#a952ae2d2b3b5f99d90b6e04700c435a3" title="Chunk LIFO.">katana::ChunkLIFO</a>) maintains a single global queue (or stack) for chunks of work items.</li>
<li><a class="el" href="namespacekatana.html#ab846f7bdd2bd0cecf06708c1806a668f" title="Distributed chunked FIFO.">katana::PerSocketChunkFIFO</a> (or <a class="el" href="namespacekatana.html#a61ae784a4e1b6a4885f4a32d144938ec" title="Distributed chunked LIFO.">katana::PerSocketChunkLIFO</a>) maintains a queue (or stack) of chunks per socket (multi-core processor) in the system. A thread tries to find a chunk in its local socket before stealing from other sockets.</li>
<li><a class="el" href="namespacekatana.html#ae2871917f6d0efc6dbe0207c6baa2429">katana::PerThreadChunkFIFO</a> (or <a class="el" href="namespacekatana.html#a4a2f492fc05abc037f021bfef430f3f1">katana::PerThreadChunkLIFO</a>) maintains a queue (or stack) of chunks per thread. Normally threads steal work within their socket, and only the leader of a socket can steal from other sockets when its own socket is out of work.</li>
</ul>
<p>Below is an example of using chunked worklists from <a class="el" href="lonestar_2tutorial_examples_2SSSPPushSimple_8cpp-example.html">lonestar/tutorial_examples/SSSPPushSimple.cpp</a>:</p>
<div class="fragment"><div class="line">    <a class="code" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81">katana::for_each</a>(</div>
<div class="line">        <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(</div>
<div class="line">            {*graph.begin()}),  <span class="comment">// initial range using initializer list</span></div>
<div class="line">        SSSP                    <span class="comment">// operator</span></div>
<div class="line">        ,</div>
<div class="line">        katana::wl&lt;PSchunk&gt;()  <span class="comment">// options. PSchunk expands to</span></div>
<div class="line">                               <span class="comment">// katana::PerSocketChunkLIFO&lt;16&gt;,</span></div>
<div class="line">                               <span class="comment">// where 16 is chunk size</span></div>
<div class="line">        ,</div>
<div class="line">        <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;sssp_dchunk16&quot;</span>));</div>
<div class="ttc" id="anamespacekatana_html_a2eb855d38b5753d67def813f9a7edb81"><div class="ttname"><a href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81">katana::for_each</a></div><div class="ttdeci">void for_each(const Range &amp;range, FunctionTy &amp;&amp;fn, Args &amp;&amp;... args)</div><div class="ttdoc">Galois unordered set iterator.</div><div class="ttdef"><b>Definition:</b> Loops.h:52</div></div>
<div class="ttc" id="anamespacekatana_html_a664a7f49a65e22807577f6cc809a7827"><div class="ttname"><a href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a></div><div class="ttdeci">auto iterate(T &amp;container)</div><div class="ttdoc">Iterate returns a specialized range object for various container-like objects:</div><div class="ttdef"><b>Definition:</b> Range.h:296</div></div>
<div class="ttc" id="astructkatana_1_1loopname_html"><div class="ttname"><a href="structkatana_1_1loopname.html">katana::loopname</a></div><div class="ttdef"><b>Definition:</b> Traits.h:211</div></div>
</div><!-- fragment --><h1><a class="anchor" id="obim_wl"></a>
Ordered By Integer Metric (OBIM)</h1>
<p><a class="el" href="structkatana_1_1OrderedByIntegerMetric.html" title="Approximate priority scheduling.">katana::OrderedByIntegerMetric</a> is suitable for implementing soft priorities, by which active work items can be prioritized but priority inversion will not lead to wrong answers or deadlock. OBIM expects two template parameters:</p><ol type="1">
<li>An indexer mapping work items to integers. Lower values have higher priorities.</li>
<li>The type of worklist for each priority bin.</li>
</ol>
<p>Below is an example of defining a <a class="el" href="structkatana_1_1OrderedByIntegerMetric.html" title="Approximate priority scheduling.">katana::OrderedByIntegerMetric</a> scheduling in <a class="el" href="lonestar_2tutorial_examples_2SSSPPushSimple_8cpp-example.html">lonestar/tutorial_examples/SSSPPushSimple.cpp</a>:</p>
<div class="fragment"><div class="line">  <span class="comment">// Priority Function in SSSPPushSimple</span></div>
<div class="line">  <span class="comment">// Map user-defined priority to a bucket number in OBIM</span></div>
<div class="line">  <span class="keyword">auto</span> reqIndexer = [&amp;](<span class="keyword">const</span> <a class="code" href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a>&amp; N) {</div>
<div class="line">    <span class="keywordflow">return</span> (graph.getData(N, <a class="code" href="namespacekatana.html#a679ab3b4021187532d65e16ceb3fc246a937e6a98c210e6d3d0af5ed55de70d3b">katana::MethodFlag::UNPROTECTED</a>) &gt;&gt; stepShift);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacekatana.html">katana</a>;</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="async_8cpp.html#ad91644deb0c87b6fbcc8a46dac0f3584">PSchunk</a> = PerSocketChunkLIFO&lt;16&gt;;  <span class="comment">// chunk size 16</span></div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="structkatana_1_1OrderedByIntegerMetric.html">OBIM</a> = OrderedByIntegerMetric&lt;decltype(reqIndexer), <a class="code" href="async_8cpp.html#ad91644deb0c87b6fbcc8a46dac0f3584">PSchunk</a>&gt;;</div>
<div class="ttc" id="aasync_8cpp_html_ad91644deb0c87b6fbcc8a46dac0f3584"><div class="ttname"><a href="async_8cpp.html#ad91644deb0c87b6fbcc8a46dac0f3584">PSchunk</a></div><div class="ttdeci">katana::PerSocketChunkFIFO&lt; ASYNC_CHUNK_SIZE &gt; PSchunk</div><div class="ttdef"><b>Definition:</b> async.cpp:32</div></div>
<div class="ttc" id="ajaccard_8cpp_html_ac56cf62167e787bf1a4ff1e5b529e0b0"><div class="ttname"><a href="jaccard_8cpp.html#ac56cf62167e787bf1a4ff1e5b529e0b0">GNode</a></div><div class="ttdeci">Graph::Node GNode</div><div class="ttdef"><b>Definition:</b> jaccard.cpp:31</div></div>
<div class="ttc" id="anamespacekatana_html"><div class="ttname"><a href="namespacekatana.html">katana</a></div><div class="ttdoc">Construct a PropertyGraph in memory.</div><div class="ttdef"><b>Definition:</b> Allocators.h:43</div></div>
<div class="ttc" id="anamespacekatana_html_a679ab3b4021187532d65e16ceb3fc246a937e6a98c210e6d3d0af5ed55de70d3b"><div class="ttname"><a href="namespacekatana.html#a679ab3b4021187532d65e16ceb3fc246a937e6a98c210e6d3d0af5ed55de70d3b">katana::MethodFlag::UNPROTECTED</a></div><div class="ttdeci">@ UNPROTECTED</div></div>
<div class="ttc" id="astructkatana_1_1OrderedByIntegerMetric_html"><div class="ttname"><a href="structkatana_1_1OrderedByIntegerMetric.html">katana::OrderedByIntegerMetric</a></div><div class="ttdoc">Approximate priority scheduling.</div><div class="ttdef"><b>Definition:</b> Obim.h:154</div></div>
</div><!-- fragment --><p> The reqIndexer object defines the priority binning function. Internally this OBIM uses a PerSocketChunkLIFO to store the items with the same priority. The following code snippet shows how to use OBIM with <a class="el" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81" title="Galois unordered set iterator.">katana::for_each</a>:</p>
<div class="fragment"><div class="line">    <a class="code" href="namespacekatana.html#a2eb855d38b5753d67def813f9a7edb81">katana::for_each</a>(</div>
<div class="line">        <a class="code" href="namespacekatana.html#a664a7f49a65e22807577f6cc809a7827">katana::iterate</a>(</div>
<div class="line">            {*graph.begin()}),  <span class="comment">// initial range using initializer list</span></div>
<div class="line">        SSSP                    <span class="comment">// operator</span></div>
<div class="line">        ,</div>
<div class="line">        katana::wl&lt;OBIM&gt;(reqIndexer)  <span class="comment">// options. Pass an indexer instance for</span></div>
<div class="line">                                      <span class="comment">// OBIM construction.</span></div>
<div class="line">        ,</div>
<div class="line">        <a class="code" href="structkatana_1_1loopname.html">katana::loopname</a>(<span class="stringliteral">&quot;sssp_obim&quot;</span>));</div>
</div><!-- fragment --><p> OBIM works well when the algorithms performance is sensitive to scheduling, and the work-items can be grouped into a small number of bins, ordered by integer priority (typically ~1000 bins). For example, when a single-source shortest path problem, focusing on nodes with lower distances will converge faster if there are sufficient number of nodes to be processed in parallel.</p>
<h1><a class="anchor" id="bsp_wl"></a>
BulkSynchronous</h1>
<p>When parallel execution is organized in rounds separated by barriers, existing work items are processed in current round, while new items generated in current round will be postponed until the next round. If this is the case, <a class="el" href="classkatana_1_1BulkSynchronous.html" title="Bulk-synchronous scheduling.">katana::BulkSynchronous</a> can be used to avoid maintaining two worklists explicitly in user code. The underlying worklist for rounds can be customized by providing template parameters to <a class="el" href="classkatana_1_1BulkSynchronous.html" title="Bulk-synchronous scheduling.">katana::BulkSynchronous</a>.</p>
<h1><a class="anchor" id="lq_wl"></a>
LocalQueue</h1>
<p><a class="el" href="structkatana_1_1LocalQueue.html">katana::LocalQueue</a> creates local non-shared worklists which are used for all work generated during concurrent operation and use a global worklist for all initial work.</p>
<h1><a class="anchor" id="onwer_wl"></a>
OwnerComputes</h1>
<p><a class="el" href="structkatana_1_1OwnerComputes.html">katana::OwnerComputes</a> is similar to <a class="el" href="structkatana_1_1LocalQueue.html">katana::LocalQueue</a>. The differences are listed below:</p><ol type="1">
<li>The user can provide a mapper as a template parameter to <a class="el" href="structkatana_1_1OwnerComputes.html">katana::OwnerComputes</a>. This mapper maps work items to threads, represented as integers in the interval of [0, numThreads). A thread may generate a work item and specify another thread to process it.</li>
<li>The underlying worklists are maintained per socket.</li>
</ol>
<h1><a class="anchor" id="stable_iter_wl"></a>
StableIterator</h1>
<p><a class="el" href="structkatana_1_1StableIterator.html" title="Low-overhead worklist when initial range is not invalidated by the operator.">katana::StableIterator</a> can be used when loop iterates over a fixed range of items, and the operator does not generate new work items. It is different from <a class="el" href="namespacekatana.html#ab9ea3b9de54b0c2f223eb585f4aefaff" title="Standard do-all loop.">katana::do_all</a> in the sense that it supports speculation and allows for iterations to abort.</p>
<h1><a class="anchor" id="seq_wl"></a>
Sequential Worklists</h1>
<p>Galois also provides sequential worklists, where push() and pop() need to acquire locks. As such, sequential schedulers are not scalable beyond a few number of threads, so we recommend not using them with parallel loops.</p>
<ul>
<li><a class="el" href="namespacekatana.html#a84226ce246b0237245e6bb9069c7d092">katana::FIFO</a> (<a class="el" href="namespacekatana.html#acf7993944566434d2c819d10213374ee">katana::LIFO</a>) implements std::queue (std::stack) like behavior.</li>
<li><a class="el" href="classkatana_1_1OrderedList.html">katana::OrderedList</a> implements a std::priority_queue compatible priority queue. Elements of same priority are processed in arbitrary order. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Manual.html">Manual</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
